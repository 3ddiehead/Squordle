// This useEffect acts on shuckle reagrding movement/proximity
// behaviors at ~60fps
useEffect(() => {
    if (props.shuckleDir[2] === 2) {
        setShuckleAction("followPoffin");
        setShuckleThought("");
        setActFrame(0);
    }

    if (shuckleAction === "followMouse") {
        setTimeout(() => {
            setNearGoal(isNearGoal());
            setShuckleDir(mousePos);
            changeShucklePos(mousePos);
            if (props.shuckleDir[2] === 1) {
                setNearGoal(false);
                setShuckleAction("followPoffin");
            }
        }, 16);
    }
    else if (shuckleAction === "followPoffin") {
        setTimeout(() => {
            setShuckleDir(props.shuckleDir);
            if (shuckleDir[2] === 0 && isNearGoal())
                setNearGoal(true);
            else {
                setNearGoal(false);
                setActNum(0);
            }
            changeShucklePos([shuckleDir[0] + 15, shuckleDir[1]]);
        }, 16);
    }
    else if (shuckleAction === "behaveAngrily") {
        if (!justAte) {
            setTimeout(() => {
                if(isNearGoal())
                    setNearGoal(true);
                else {
                    setNearGoal(false);
                    setActNum(0)
                }
                changeShucklePos(shuckleDir);
            }, 16);
        }
    }
    else if (shuckleAction === "layEgg") {
        setTimeout(() => {

        }, 16);
    }
    else if(shuckleAction === "getSick") {
        setTimeout(() => {

        }, 16);
    }

        else if (shuckleBehavior === behavior.SHINY && !justAte) {
            if (obfuscation > 1.5) {
                window.localStorage.shuckleShiny = "1";
                setObfuscation(1);
            }
            else if (window.localStorage.shuckleShiny === "0") {
                setTimeout(() => {
                    setObfuscation(obfuscation + 0.005)
                }, 16);
            }
            else if (window.localStorage.shuckleShiny === "1") {
                setTimeout(() => {
                    if (obfuscation <= 0) {
                        setObfuscation(0);
                        setShuckleBehavior(emotion.HAPPY);
                        setJustAte("true");
                    }
                    setObfuscation(obfuscation - 0.003)
                }, 16);
            }
		}

    else if (shuckleAction === "turnShiny"){
        if (!justAte){
            if (obfuscation > 1.5) {
                window.localStorage.shuckleShiny = "1";
                setObfuscation(1);
            }
            else if (window.localStorage.shuckleShiny === "0") {
                setTimeout(() => {
                    var xJitter = randomJitters[
                        Math.floor(Math.random() * randomJitters.length)]
                        * posNegNull[Math.floor(Math.random() * posNegNull.length)];

                    var yJitter = randomJitters[
                        Math.floor(Math.random() * randomJitters.length)]
                        * posNegNull[Math.floor(Math.random() * posNegNull.length)];

                    setShucklePos([shucklePos[0] + xJitter, shucklePos[1] + yJitter])
                    setObfuscation(obfuscation + 0.005)
                }, 16);
            }
            else if (window.localStorage.shuckleShiny === "1") {
                setTimeout(() => {
                    var xJitter = smallJitters[
                        Math.floor(Math.random() * smallJitters.length)]
                        * posNegNull[Math.floor(Math.random() * posNegNull.length)];

                    var yJitter = smallJitters[
                        Math.floor(Math.random() * smallJitters.length)]
                        * posNegNull[Math.floor(Math.random() * posNegNull.length)];

                    setShucklePos([shucklePos[0] + xJitter, shucklePos[1] + yJitter])
                    if (obfuscation <= 0) {
                        setObfuscation(0);
                        setShuckleThought("");
                        setShuckleAction("beHappy");
                        setJustAte("true");
                    }
                    setObfuscation(obfuscation - 0.003)
                }, 16);
            }
        }
    }
});

//This useEffect acts on shuckle regarding goal based behaviors
useEffect(() => {
    if (shuckleAction === "followPoffin"){
        setTimeout(() => {
            if (actNum === 5) {
                // derealizePoffin(); ? ? ?
                setActNum(0);
                setNearGoal(false);
                setShuckleAction("followMouse")

                if (poffinEaten === 0)					
                    setShuckleAction("followMouse");
                else if (poffinEaten === 1) {
                    chooseKey()
                    setShuckleAction("behaveAngrily");
                    setNearGoal(false);
                    setJustAte(true);
                }
                else if (poffinEaten === 2)				
                    setShuckleAction("layEgg");
                else if (poffinEaten === 3)				
                    setShuckleAction("getSick");
                else if (poffinEaten === 4) {
                    if (window.localStorage.shuckleShiny === "0") {
                        setShuckleAction("turnShiny");
                        setShuckleThought("confused");
                    }
                    else
                        setShuckleAction("beNonplussed");
                    setJustAte(true);
                }
                else if (poffinEaten === 5) {
                    setShuckleAction("beHappy")
                    setJustAte(true);
                }
            }
            else {
                if (actFrame === 5) {
                    setActNum(actNum + 1);
                    setActFrame(0);
                }
                else
                    setActFrame(actFrame+1);
            }
        }, 200);
    }
    else if (shuckleAction === "behaveAngrily") {
        setTimeout(() => {
            if (angerIcon === 1)
                setAngerIcon(0);
            else
                setAngerIcon(angerIcon + 1);
        }, 1000);

        setTimeout(() => {
            if (actNum === 7) {
                destroyKey();
                setActNum(0);
                setNearGoal(false);
                setTimeout(() => {
                    chooseKey()
                }, 500);
            }
            else {
                if (actFrame === 9) {
                    setActNum(actNum+1);
                    setActFrame(0);
                }
                else
                    setActFrame(actFrame + 1);
            }
        }, 100);
    }
    else if (shuckleAction === "beHappy") {
        setTimeout(() => {
            setActFrame((actFrame + 1) % 2);
            if (!justAte) {
                setActFrame(0);
                setShuckleAction("followMouse");
            }	
        }, 500);
    }
    else if (shuckleAction === "turnShiny") {
        if (shuckleThought === "confused") {
            setTimeout(() => {
                setActFrame((actFrame + 1) % 2);
                if (!justAte) {
                    setActFrame(0);
                    setShuckleThought("surprised");
                }	
            }, 500);
        }
    }
    else if (shuckleAction === "beNonplussed") {
        setTimeout(() => {
            setActFrame((actFrame + 1) % 2);
            if(!justAte) {
                setActFrame(0);
                setShuckleAction("followMouse");
            }	
        }, 500);
    }
});

//This useEffect turns "justAte" on and off after 2500ms
useEffect(() => {
    if (justAte)
        setTimeout(() => {
            setJustAte(false);
        }, 2500);
});


{shuckleAction === "followMouse" && nearGoal && (
    <div>
        <img className = "heart" 
             style = {{position: "absolute",
                       left: String(shucklePos[0]) + "px",
                       top: String(shucklePos[1]) + "px"}} 
             src = {require("../assets/shuckleLove.gif")}/>
        <img className = "heart" 
             style = {{position:"absolute",
                       left: String(shucklePos[0] + 28) + "px",
                       top: String(shucklePos[1]-6)+"px"}} 
             src = {require("../assets/shuckleLove.gif")}/>
        <img className = "heart" 
             style = {{position: "absolute",
                       left: String(shucklePos[0] + 13) + "px",
                       top: String(shucklePos[1] - 10) + "px"}} 
            src = {require("../assets/shuckleLove.gif")}/>
    </div>
)}
{shuckleAction === "behaveAngrily" && (
    <div>
    <img className = "wordBubble" 
         style = {{width: "32px",
                   height: "32px",
                   position: "absolute",
                   left: String(shucklePos[0] + 18) + "px",
                   top: String(shucklePos[1] - 18) + "px"}} 
         src = {require("../assets/wordBubble.png")}/>
    {angerIcon === 0 && 
        <img className = "angerIcon" 
             style = {{width: "18px",
                       height: "18px",
                       position: "absolute",
                       left: String(shucklePos[0] + 25) + "px",
                       top: String(shucklePos[1] - 14) + "px"}} 
             src = {require("../assets/angerIcon.png")}/>}
    {angerIcon===1 && 
        <img className = "hotspringsIcon" 
             style = {{width: "18px",
                       height: "18px",
                       position: "absolute",
                       left: String(shucklePos[0] + 25) + "px",
                       top: String(shucklePos[1] - 14) + "px"}} 
             src = {require("../assets/fireIcon.png")}/>}
    </div>
)}
{shuckleAction === "behaveAngrily" && nearGoal && (
    <div>
    <img className="slash" 
         style = {{opacity: slashFrameList[actFrame][1],
                   width: "36px",
                   height: "36px",
                   transform: "scaleX(" + slashAlt() + ")",
                   zIndex: "2",
                   position: "absolute",
                   left: String(shuckleDir[0] + 2) + "px",
                   top: String(shuckleDir[1] + 5) + "px"}} 
         src = {require("../assets/slash" + 
                    slashFrameList[actFrame][0]+".png")}/>
    </div>
)}
{shuckleAction === "followPoffin" && nearGoal && (
    <div>
    <img className = "bite" 
         style = {{opacity: biteFrameList[actFrame][2],
                   zIndex: "2", 
                   position: "absolute",
                   left: String(shuckleDir[0])+"px",
                   top: String(shuckleDir[1] + 
                        biteFrameList[actFrame][0]) + "px"}}
         src = {require("../assets/bite.png")}/>
    <img className = {classes.underbite} 
         style = {{opacity: biteFrameList[actFrame][2],
                   zIndex: "2",
                   position: "absolute",
                   left: String(shuckleDir[0]) + "px",
                   top: String(shuckleDir[1] + 
                        biteFrameList[actFrame][1]) + "px"}}
         src = {require("../assets/bite.png")}/>
    </div>
)}
{shuckleAction === "beHappy" && (
    <div>
    <img className = "musicNote" 
         style = {{position: "absolute",
                   left: String(shucklePos[0] + 24) + "px",
                   top: String(shucklePos[1] + 
                        musicFrameList[actFrame]) + "px"}} 
         src = {require("../assets/singleNote.png")}/>
    <img className = "musicNote" 
         style = {{position: "absolute",
                   left: String(shucklePos[0] + 5) + "px",
                   top: String(shucklePos[1] + 
                        musicFrameList[actFrame]) + "px"}} 
         src = {require("../assets/eighthNotes.png")}/>
    </div>
)}
{shuckleAction === "beNonplussed" && (
    <div>
    <img className = "musicNote" 
         style = {{position: "absolute",
                   left: String(shucklePos[0] + 24) + "px",
                   top: String(shucklePos[1] + 
                        musicFrameList[actFrame]) + "px"}} 
         src = {require("../assets/singleNote.png")}/>
    <img className = "musicNote" 
         style = {{position: "absolute",
                   left: String(shucklePos[0] + 5) + "px",
                   top: String(shucklePos[1] + 
                        musicFrameList[actFrame]) + "px"}} 
         src = {require("../assets/eighthNotes.png")}/>
    </div>
)}
{shuckleThought === "confused" && (
    <div>
    <img className = "questionMark" 
         style = {{position: "absolute",
                   left: String(shucklePos[0] + 24) + "px",
                   top: String(shucklePos[1] + 
                      musicFrameList[actFrame]) + "px"}} 
         src = {require("../assets/questionMark.png")}/>
    </div>
)}
{shuckleThought === "surprised" && (
    <div>
    <img className = "exclamationPoint" 
         style = {{position: "absolute",
                   left: String(shucklePos[0] + 24) + "px",
                   top: String(shucklePos[1] + 
                        musicFrameList[actFrame]) + "px"}}
                   src={require("../assets/exclamationPoint.png")}/>
    </div>
)}
{obfuscation !== 0 && (
    <div>
    <img className = "cloudCover" 
         style = {{width: "64px",
                   height: "64px",
                   zIndex: "1",
                   opacity: String(obfuscation),
                   position: "absolute",
                   left: String(shucklePos[0] - 10) + "px",
                   top: String(shucklePos[1] - 5) + "px"}} 
         src = {require("../assets/cloudCover.png")}/>
    </div>
)}
{window.localStorage.shuckleShiny === "0" && 
    <img className = "shuckle" 
         style = {{position: "absolute",
                   left: shucklePos[0] + "px",
                   top: shucklePos[1] + "px"}} 
         src = {require("../assets/shuckle.gif")}/> }
{window.localStorage.shuckleShiny === "1" && 
    <img className = "shuckle" 
         style = {{position: "absolute",
                   left: shucklePos[0] + "px",
                   top: shucklePos[1] + "px"}} 
         src = {require("../assets/shuckleShiny.gif")}/> }
